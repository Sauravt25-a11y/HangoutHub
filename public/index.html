<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HangoutHub - Video Conferencing & Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <link href="style.css" rel="stylesheet" />
</head>
<body class="bg-gradient-to-br from-gray-900 to-black text-white flex flex-col h-screen">

  <!-- Login Page -->
  <div id="homePage" class="flex items-center justify-center h-screen">
    <div class="bg-white rounded-lg shadow-xl p-8 text-center w-96">
      <h1 class="text-2xl font-bold text-gray-800 mb-6">Welcome to HangoutHub</h1>
      <p class="text-gray-600 mb-6">Sign in with Google to start video calling and chatting</p>
      
      <!-- Google Sign In Button -->
      <div id="googleSignInContainer" class="mb-6">
        <button 
          id="googleSignInBtn" 
          type="button"
          class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center justify-center gap-3"
        >
          <svg width="18" height="18" viewBox="0 0 48 48">
            <path fill="#4285F4" d="M24 9.5c3.9 0 6.9 1.3 9 2.4L40.5 4.3C36.2 1.5 30.6 0 24 0 14.6 0 6.8 5.7 3.4 13.9l7.3 5.7C12.8 14.4 18 9.5 24 9.5z"/>
            <path fill="#34A853" d="M46.6 24.3c0-1.6-.1-3.1-.4-4.5H24v9h12.7c-.5 2.8-2.1 5.2-4.4 6.8l7.1 5.5c4.2-3.9 6.2-9.6 6.2-16.8z"/>
            <path fill="#FBBC04" d="M10.7 28.6c-.8-2.4-.8-5.1 0-7.5l-7.3-5.7C1.2 19.1 0 21.4 0 24s1.2 4.9 3.4 8.6l7.3-5.7z"/>
            <path fill="#EA4335" d="M24 48c6.5 0 11.9-2.1 15.9-5.8l-7.1-5.5c-2.2 1.5-5 2.4-8.8 2.4-6 0-11.2-4.9-13.3-10.2l-7.3 5.7C6.8 42.3 14.6 48 24 48z"/>
          </svg>
          Continue with Google
        </button>
      </div>

      <!-- Loading State -->
      <div id="loadingState" class="hidden">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"></div>
        <p class="text-gray-600">Signing you in...</p>
      </div>

      <!-- User Profile (after login) -->
      <div id="userProfile" class="hidden mb-6">
        <div class="flex items-center justify-center mb-4">
          <img id="userAvatar" src="" alt="User Avatar" class="w-16 h-16 rounded-full border-2 border-blue-500">
        </div>
        <h3 id="userDisplayName" class="text-lg font-semibold text-gray-800"></h3>
        <p id="userEmail" class="text-sm text-gray-600 mb-4"></p>
        <button 
          id="logoutBtn" 
          type="button"
          class="text-sm text-red-600 hover:text-red-800 underline"
        >
          Sign Out
        </button>
      </div>

      <!-- Room Controls (shown after login) -->
      <div id="roomControls" class="hidden space-y-3">
        <button 
          id="createRoomBtn" 
          type="button"
          aria-label="Create a new room"
          class="w-full bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-colors font-medium"
        >
          Create Room
        </button>
        
        <div class="flex gap-2">
          <label for="roomCodeInput" class="sr-only">Room code</label>
          <input 
            id="roomCodeInput" 
            name="roomCode"
            type="text" 
            placeholder="Enter Room Code"
            aria-label="Enter room code to join"
            class="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-gray-800"
            maxlength="8"
          />
          <button 
            id="joinRoomBtn" 
            type="button"
            aria-label="Join room with code"
            class="bg-purple-600 text-white py-3 px-6 rounded-lg hover:bg-purple-700 transition-colors font-medium"
          >
            Join
          </button>
        </div>
      </div>

      <!-- Error Message -->
      <div id="errorMessage" class="hidden mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded"></div>
    </div>
  </div>

  <!-- Main App (same as before) -->
  <div id="chatApp" class="hidden flex flex-col flex-grow h-full">
    <!-- Header -->
    <header class="bg-gray-800 p-4 flex justify-between items-center text-white">
      <div class="flex items-center space-x-3">
        <h2 class="text-lg font-semibold">HangoutHub</h2>
        <div class="text-sm">
          Room: <span id="roomCodeDisplay" class="font-mono text-green-400 font-bold"></span>
        </div>
      </div>
      <div class="flex items-center space-x-4">
        <!-- User Info in Header -->
        <div id="headerUserInfo" class="flex items-center space-x-2">
          <img id="headerUserAvatar" src="" alt="User" class="w-8 h-8 rounded-full border-2 border-blue-500">
          <span id="headerUserName" class="text-sm"></span>
        </div>
        <div class="flex space-x-2">
          <button 
            id="copyRoomCode" 
            type="button"
            aria-label="Copy room code to clipboard"
            class="bg-gray-700 px-3 py-1 rounded hover:bg-gray-600 text-sm"
          >
            Copy Code
          </button>
          <button 
            id="leaveCallBtn" 
            type="button"
            aria-label="Leave the call"
            class="bg-red-600 px-3 py-1 rounded hover:bg-red-700 text-sm"
          >
            Leave
          </button>
        </div>
      </div>
    </header>

    <main class="flex flex-grow overflow-hidden">
      <!-- Sidebar -->
      <aside id="sidebar" class="w-64 bg-gray-900 p-4 flex flex-col">
        <h2 class="text-lg font-bold mb-3">Participants</h2>
        <ul id="userList" class="flex-grow overflow-auto space-y-2 mb-4" role="list"></ul>
        <button 
          id="admitAllBtn" 
          type="button"
          aria-label="Admit all waiting users"
          class="bg-blue-600 py-2 px-4 rounded hover:bg-blue-700 hidden mb-2"
        >
          Admit All Waiting
        </button>
        
        <!-- File Sharing Section -->
        <div class="border-t border-gray-700 pt-4 mt-4">
          <h3 class="text-md font-semibold mb-2">File Sharing</h3>
          <div class="space-y-2">
            <label for="fileInput" class="sr-only">Select files to upload</label>
            <input 
              type="file" 
              id="fileInput" 
              name="files"
              multiple 
              aria-label="Select files to upload"
              class="upload-input-hidden" 
              accept="*/*"
            />
            <button 
              id="uploadBtn" 
              type="button"
              aria-label="Upload files to share with participants"
              class="w-full bg-purple-600 py-2 px-3 rounded hover:bg-purple-700 text-sm"
            >
              üìé Upload Files
            </button>
            <button 
              id="toggleFilesBtn" 
              type="button"
              aria-label="View shared files"
              class="w-full bg-gray-700 py-2 px-3 rounded hover:bg-gray-600 text-sm"
            >
              üìÅ View Files (0)
            </button>
          </div>
        </div>
      </aside>

      <!-- Video Area -->
      <section class="flex flex-col flex-grow relative bg-gray-800">
        <!-- Local Video (Picture-in-Picture) -->
        <video
          id="localVideo"
          autoplay
          muted
          aria-label="Your video feed"
          class="local-video-pip"
        ></video>

        <!-- Remote Videos Grid -->
        <div id="remoteVideos" class="flex-1 p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 overflow-auto" role="region" aria-label="Remote participant videos">
          <!-- Remote videos will be added here -->
        </div>

        <!-- Media Controls -->
        <div class="media-controls-container">
          <div class="media-controls-panel">
            <button 
              id="micBtn" 
              type="button"
              class="media-btn bg-green-500 hover:bg-green-600" 
              title="Toggle Microphone"
              aria-label="Toggle microphone on/off"
            >
              üé§
            </button>
            <button 
              id="cameraBtn" 
              type="button"
              class="media-btn bg-blue-500 hover:bg-blue-600" 
              title="Toggle Camera"
              aria-label="Toggle camera on/off"
            >
              üìπ
            </button>
            <button 
              id="screenShareBtn" 
              type="button"
              class="media-btn bg-purple-500 hover:bg-purple-600" 
              title="Share Screen"
              aria-label="Share your screen"
            >
              üñ•Ô∏è
            </button>
            <button 
              id="chatToggleBtn" 
              type="button"
              class="media-btn bg-gray-600 hover:bg-gray-700" 
              title="Toggle Chat"
              aria-label="Open or close chat panel"
            >
              üí¨
            </button>
          </div>
        </div>
      </section>
    </main>

    <!-- Chat Panel -->
    <div id="chatPanel" class="chat-panel">
      <div class="p-4 border-b border-gray-700 flex justify-between items-center">
        <h3 class="text-white font-semibold text-lg">Chat</h3>
        <button 
          id="closeChatBtn" 
          type="button"
          aria-label="Close chat panel"
          class="text-white text-xl font-bold hover:text-gray-300"
        >
          √ó
        </button>
      </div>
      <div id="messages" class="flex-1 overflow-auto p-4 space-y-2" role="log" aria-label="Chat messages"></div>
      <form id="messageForm" class="p-4 border-t border-gray-700">
        <div class="flex space-x-2">
          <label for="messageInput" class="sr-only">Type your message</label>
          <input 
            id="messageInput" 
            name="message"
            type="text" 
            placeholder="Type a message..."
            aria-label="Type your message"
            class="flex-1 p-2 rounded bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
            maxlength="500"
            required
          />
          <button 
            type="submit"
            aria-label="Send message"
            class="bg-blue-600 px-4 py-2 rounded hover:bg-blue-700 text-white font-medium"
          >
            Send
          </button>
        </div>
      </form>
    </div>

    <!-- Files Panel -->
    <div id="filesPanel" class="files-panel">
      <div class="p-4 border-b border-gray-700 flex justify-between items-center">
        <h3 class="text-white font-semibold text-lg">Shared Files</h3>
        <button 
          id="closeFilesBtn" 
          type="button"
          aria-label="Close files panel"
          class="text-white text-xl font-bold hover:text-gray-300"
        >
          √ó
        </button>
      </div>
      <div id="filesList" class="flex-1 overflow-auto p-4 space-y-2" role="region" aria-label="Shared files list">
        <div id="noFilesMessage" class="text-gray-400 text-center py-8">
          No files shared yet
        </div>
      </div>
      <div class="p-4 border-t border-gray-700">
        <div class="flex space-x-2">
          <button 
            id="uploadFilesBtn"
            type="button"
            aria-label="Upload files to share"
            class="flex-1 bg-purple-600 px-4 py-2 rounded hover:bg-purple-700 text-white font-medium"
          >
            üìé Upload Files
          </button>
          <button 
            id="refreshFilesBtn"
            type="button"
            aria-label="Refresh files list"
            class="bg-gray-700 px-4 py-2 rounded hover:bg-gray-600 text-white"
          >
            üîÑ
          </button>
        </div>
      </div>
    </div>

    <!-- Upload Progress Modal -->
    <div id="uploadModal" class="upload-modal" role="dialog" aria-labelledby="uploadModalTitle" aria-modal="true">
      <div class="bg-gray-800 p-6 rounded-lg w-96">
        <h3 id="uploadModalTitle" class="text-lg font-semibold mb-4">Uploading Files...</h3>
        <div class="space-y-3">
          <div 
            id="uploadProgress" 
            class="w-full bg-gray-700 rounded-full h-2" 
            role="progressbar" 
            aria-label="File upload progress"
            aria-valuenow="0" 
            aria-valuemin="0" 
            aria-valuemax="100"
            title="Upload progress"
          >
            <div id="uploadProgressBar" class="upload-progress-bar"></div>
          </div>
          <div id="uploadStatus" class="text-sm text-gray-300" aria-live="polite">Preparing upload...</div>
        </div>
        <button 
          id="cancelUploadBtn" 
          type="button"
          aria-label="Cancel file upload"
          class="mt-4 bg-red-600 px-4 py-2 rounded hover:bg-red-700 text-white"
        >
          Cancel
        </button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>